#!/bin/bash

# Git hook to validate commit message format
# This hook is triggered when writing a commit message

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Ignore merge commits
if echo "$commit_msg" | grep -qE "^Merge"; then
    exit 0
fi

# Minimum length check
min_length=10
if [ ${#commit_msg} -lt $min_length ]; then
    echo -e "${RED}✗ Commit message too short${NC}"
    echo -e "  Minimum length: ${min_length} characters"
    echo -e "  Your message: ${#commit_msg} characters"
    echo -e ""
    echo -e "${YELLOW}Tip:${NC} Write descriptive commit messages that explain what and why"
    exit 1
fi

# Check for common bad patterns
if echo "$commit_msg" | grep -qiE "^(wip|test|fix|update|changes?)$"; then
    echo -e "${YELLOW}⚠ Warning:${NC} Generic commit message detected"
    echo -e "  Message: ${commit_msg}"
    echo -e ""
    echo -e "${YELLOW}Consider a more descriptive message like:${NC}"
    echo -e "  ${GREEN}✓${NC} Add momentum-based trading strategy"
    echo -e "  ${GREEN}✓${NC} Fix calculation error in profit/loss computation"
    echo -e "  ${GREEN}✓${NC} Refactor data pipeline for better performance"
    echo -e ""
    echo -e "Continue anyway? [y/N] "
    read -r response
    if [[ ! "$response" =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# Optional: Conventional Commits format check (uncomment to enable)
# if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"; then
#     echo -e "${YELLOW}⚠ Consider using Conventional Commits format:${NC}"
#     echo -e "  feat: Add new feature"
#     echo -e "  fix: Fix bug"
#     echo -e "  docs: Update documentation"
#     echo -e "  refactor: Refactor code"
#     echo -e ""
# fi

echo -e "${GREEN}✓${NC} Commit message looks good"
exit 0

